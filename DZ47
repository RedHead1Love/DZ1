using System;

class Program
{
    private const int MapWidth = 20;
    private const int MapHeight = 10;
    private const int WallSpawnChance = 20;
    private const int TreasureSpawnChance = 5; 
    private const int DoorSpawnChance = 3;

    private const ConsoleKey MoveUpCommand = ConsoleKey.W;
    private const ConsoleKey MoveDownCommand = ConsoleKey.S;
    private const ConsoleKey MoveLeftCommand = ConsoleKey.A;
    private const ConsoleKey MoveRightCommand = ConsoleKey.D;
    private const ConsoleKey ExitCommand = ConsoleKey.Q;

    private const char WallSymbol = '#';
    private const char EmptySymbol = '.';
    private const char TreasureSymbol = '$';
    private const char DoorSymbol = 'D';
    private const char PlayerSymbol = '@';

    static void Main()
    {
        int playerX = 1;
        int playerY = 1;
        bool isRunning = true;

        char[,] map = InitializeMap();

        while (isRunning)
        {
            Console.Clear();
            DrawMap(map);
            DrawPlayer(playerX, playerY);

            Console.WriteLine("WASD - перемещение, Q - выход");

            ConsoleKey key = GetMovementInput();

            if (key == ExitCommand)
            {
                isRunning = false;
                continue;
            }

            GetDirection(key, out int xDirection, out int yDirection);
            TryMovePlayer(ref playerX, ref playerY, xDirection, yDirection, map);

            CheckPlayerPosition(playerX, playerY, map);
        }
    }

    static char[,] InitializeMap()
    {
        char[,] map = new char[MapHeight, MapWidth];
        Random random = new Random();

        for (int y = 0; y < MapHeight; y++)
        {
            for (int x = 0; x < MapWidth; x++)
            {
                if (x == 0 || y == 0 || x == MapWidth - 1 || y == MapHeight - 1)
                {
                    map[y, x] = WallSymbol;
                }
                else if (random.Next(0, 100) < WallSpawnChance)
                {
                    map[y, x] = WallSymbol;
                }
                else if (random.Next(0, 100) < TreasureSpawnChance)
                {
                    map[y, x] = TreasureSymbol;
                }
                else if (random.Next(0, 100) < DoorSpawnChance)
                {
                    map[y, x] = DoorSymbol;
                }
                else
                {
                    map[y, x] = EmptySymbol;
                }
            }
        }

        return map;
    }

    static void DrawMap(char[,] map)
    {
        for (int y = 0; y < map.GetLength(0); y++)
        {
            for (int x = 0; x < map.GetLength(1); x++)
            {
                Console.Write(map[y, x]);
            }
            Console.WriteLine();
        }
    }

    static void DrawPlayer(int playerX, int playerY)
    {
        Console.SetCursorPosition(playerX, playerY);
        Console.Write(PlayerSymbol);
        Console.SetCursorPosition(0, Console.WindowHeight - 1);
    }

    static ConsoleKey GetMovementInput()
    {
        return Console.ReadKey(true).Key;
    }

    static void GetDirection(ConsoleKey key, out int xDirection, out int yDirection)
    {
        xDirection = 0;
        yDirection = 0;

        switch (key)
        {
            case MoveUpCommand:
                yDirection = -1;
                break;
            case MoveDownCommand:
                yDirection = 1;
                break;
            case MoveLeftCommand:
                xDirection = -1;
                break;
            case MoveRightCommand:
                xDirection = 1;
                break;
        }
    }

    static void TryMovePlayer(ref int playerX, ref int playerY, int xDirection, int yDirection, char[,] map)
    {
        int newX = playerX + xDirection;
        int newY = playerY + yDirection;

        if (newX < 0 || newY < 0 || newX >= map.GetLength(1) || newY >= map.GetLength(0))
            return;

        if (map[newY, newX] == WallSymbol)
            return;

        playerX = newX;
        playerY = newY;
    }

    static void CheckPlayerPosition(int playerX, int playerY, char[,] map)
    {
        char cell = map[playerY, playerX];

        if (cell == TreasureSymbol)
        {
            Console.WriteLine("Вы нашли сокровище");
            Console.ReadKey();
            map[playerY, playerX] = EmptySymbol; 
        }
        else if (cell == DoorSymbol)
        {
            Console.WriteLine("Вы нашли дверь");
            Console.ReadKey();
        }
    }
}
